<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cholera Visualization</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>


<body>
<div class="ui centered container">
  <div id="DeathTable" style=""></div>
  <div id="deathLines"></div>
</div>

</body>

<script>
  Plotly.d3.tsv("./choleraDeaths.tsv", function(err, rows) {

    function unpack(rows, key) {
      return rows.map(function(row) { return row[key]; });
    }

    var headerNames = Plotly.d3.keys(rows[0]);

    // cell values
    var cellValues = [];
    var headerValues = [];
    for (i = 0; i < headerNames.length; i++) {
      headerValue = [headerNames[i]];
      headerValues[i] = headerValue;
      cellValue = unpack(rows, headerNames[i]);
      cellValues[i] = cellValue;
    }

    // add totals
    headerValues[headerNames.length] = ["Total"];
    var totalCount = [];
    for (i = 0; i < cellValues[0].length; i++) {
      totalCount[i] = parseInt(cellValues[1][i], 10) + parseInt(cellValues[2][i], 10);
    }
    cellValues[headerNames.length] = totalCount;

    var table = [{
      type: 'table',
      header: {
        values: headerValues,
        align: "center",
        line: { width: 1, color: 'black' },
        fill: { color: "grey" },
        font: { family: "Arial", size: 12, color: "white" }
      },
      cells: {
        values: cellValues,
        align: ["center", "right", "right", "right"],
        line: { color: "black", width: 1 },
        font: { family: "Arial", size: 11, color: ["black"] }
      }
    }];

    var lineattacks = [{
      type: 'scatter',
      x: unpack(rows, 'Date'),
      y: unpack(rows, 'Attack'),
    }];


    var data = [table, lineattacks];

    var layout = {
      title: "Cholera Attacks and Deaths by Date",
      height: 600,
      width: 550
    }

    DeathTable = document.getElementById('DeathTable');
    LineChart = document.getElementById('deathLines');
    Plotly.plot(DeathTable, table, layout);
    Plotly.plot(LineChart, lineattacks, layout);
  });
</script>

</html>