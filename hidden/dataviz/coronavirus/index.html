<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Coronavirus Growth Map</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.2/semantic.min.css"/>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
                integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
                crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
                integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
                crossorigin=""></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
    </head>
    <style>
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
    <body>
        <div id="map"></div>
    </body>
    <script>
        // initialize geo map
        var mymap = L.map('map').setView([0, 0], 3);
        L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(mymap);

        var casesY = [];
        var recoveredY = [];
        var deadY = [];
        var activeY = [];

        Promise.all([
            d3.csv("./COVID-19-master/csse_covid_19_data/csse_covid_19_daily_reports/03-21-2020.csv"),
            d3.csv("./COVID-19-master/csse_covid_19_data/csse_covid_19_daily_reports/03-22-2020.csv")
        ]).then(function (data) {
            function unpack(data, key) {
                return data.map(function(row) { return row[key]; });
            };

            for (let i = 0; i < data[1].length; i++) {
                var today = data[1][i];
                var yesterday = data[0].find(item => item['Country/Region'] === today['Country/Region'] && item['Province/State'] === today['Province/State'])

                var radius = 25;
                if (today.Confirmed <= 25) {
                    radius = 2;
                }
                else if (today.Confirmed <= 100) {
                    radius = 5;
                }
                else if (today.Confirmed <= 500) {
                    radius = 8;
                }
                else if (today.Confirmed <= 1000) {
                    radius = 11;
                }
                else if (today.Confirmed <= 5000) {
                    radius = 15;
                }
                else if (today.Confirmed <= 10000) {
                    radius = 20;
                }

                var color = '#ed2d1f';
                var caseChange;
                if (yesterday) {
                    caseChange = today.Confirmed - yesterday.Confirmed;
                    
                    if (caseChange <= 3) {
                        color = '#fff4e9';
                    }
                    else if (caseChange <= 15) {
                        color = '#fccda8'
                    }
                    else if (caseChange <= 100) {
                        color = '#f8a36f'
                    }
                    else if (caseChange <= 1000) {
                        color = '#f37240'
                    }
                }
                else {
                    caseChange = today.Confirmed;
                }

                if (today['Province/State']) {
                    popup = '<h4>' + today['Province/State'] + ', ' + today['Country/Region'] + '</h4>'
                            + 'Active: ' + (today.Confirmed - today.Recovered - today.Deaths) + '<br>'
                            + 'New Daily Cases: ' + caseChange + '<br>' 
                            + 'Total Confirmed: ' + today.Confirmed + '<br>' 
                            + 'Recovered: ' + today.Recovered + '<br>' 
                            + 'Deaths: ' + today.Deaths + '<br>';
                }
                else {
                    popup = '<h4>' + today['Country/Region'] + '</h4>'
                            + 'Active: ' + (today.Confirmed - today.Recovered - today.Deaths) + '<br>'
                            + 'New Daily Cases: ' + caseChange + '<br>' 
                            + 'Total Confirmed: ' + today.Confirmed + '<br>' 
                            + 'Recovered: ' + today.Recovered + '<br>' 
                            + 'Deaths: ' + today.Deaths + '<br>';
                }

                L.circleMarker([today['Latitude'], today['Longitude']], {
                    color: color,
                    fillColor: color,
                    fillOpacity: 0.7,
                    weight: 1,
                    radius: radius
                }).addTo(mymap).bindPopup(popup);
            }
        });

        
    </script>
</html>

